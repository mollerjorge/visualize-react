---
phase: 01-sdk-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/root.tsx
  - app/routes/_index.jsx
autonomous: false

must_haves:
  truths:
    - "OpenPanel SDK loads without console errors"
    - "Pageview event appears in OpenPanel dashboard within 60s"
    - "Mixpanel continues tracking (no regressions)"
    - "No duplicate pageview events"
  artifacts:
    - path: "app/root.tsx"
      provides: "OpenPanel script tag injection"
      contains: "window.op"
    - path: "app/routes/_index.jsx"
      provides: "Mixpanel config with disabled auto-pageview"
      contains: "track_pageview: false"
  key_links:
    - from: "app/root.tsx"
      to: "https://openpanel.dev/op1.js"
      via: "script tag with defer async"
      pattern: "op1\\.js.*defer.*async"
    - from: "app/root.tsx"
      to: "OpenPanel dashboard"
      via: "clientId in init config"
      pattern: "c1eb2b83-2218-46cd-907b-ce5681c8ad76"
---

<objective>
Initialize OpenPanel SDK with auto-pageview tracking, disable Mixpanel duplicate tracking

Purpose: Establish analytics foundation for all future event tracking
Output: Working OpenPanel integration visible in dashboard
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-sdk-integration/01-RESEARCH.md
@app/root.tsx
@app/routes/_index.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add OpenPanel script tag to root.tsx</name>
  <files>app/root.tsx</files>
  <action>
Add OpenPanel initialization after LiveReload in body:

1. Add proxy pattern script (queues events before SDK loads):
```javascript
window.op=window.op||function(){var n=[];return new Proxy(function(){arguments.length&&n.push([].slice.call(arguments))},{get:function(t,r){return"q"===r?n:function(){n.push([r].concat([].slice.call(arguments)))}} ,has:function(t,r){return"q"===r}}) }();
```

2. Initialize with config:
```javascript
window.op('init', {
  clientId: 'c1eb2b83-2218-46cd-907b-ce5681c8ad76',
  trackScreenViews: true,
  trackOutgoingLinks: true,
  trackAttributes: true,
});
```

3. Load SDK script:
```html
<script src="https://openpanel.dev/op1.js" defer async />
```

Use dangerouslySetInnerHTML for inline scripts. Place after LiveReload to ensure Remix hydrates first.

DO NOT add loader/useLoaderData for env vars - use hardcoded client ID for simplicity (env var support can be added later if needed).
  </action>
  <verify>npm run build succeeds, npm run dev starts without hydration errors</verify>
  <done>OpenPanel script tags present in root.tsx body, app builds and runs</done>
</task>

<task type="auto">
  <name>Task 2: Disable Mixpanel auto-pageview and debug mode</name>
  <files>app/routes/_index.jsx</files>
  <action>
Modify mixpanel.init() config (around line 19):

Change from:
```javascript
mixpanel.init("fa22af7fecb1e5b8d0c88bd7111c0c63", {
  debug: true,
  track_pageview: true,
  persistence: "localStorage",
});
```

To:
```javascript
mixpanel.init("fa22af7fecb1e5b8d0c88bd7111c0c63", {
  debug: false,
  track_pageview: false,
  persistence: "localStorage",
});
```

Changes:
- debug: false - prevents console spam in production
- track_pageview: false - OpenPanel now handles pageview tracking

DO NOT change any other Mixpanel configuration or remove existing event tracking calls.
  </action>
  <verify>grep for "track_pageview: false" in _index.jsx returns match</verify>
  <done>Mixpanel config has track_pageview: false and debug: false</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>OpenPanel SDK integration with auto-pageview tracking</what-built>
  <how-to-verify>
1. Run `npm run dev` and open http://localhost:3000
2. Open browser DevTools > Console - verify NO errors related to OpenPanel or hydration
3. Open browser DevTools > Network - verify op1.js loads successfully (200 status)
4. Open OpenPanel dashboard (https://openpanel.dev) and navigate to your project
5. Wait up to 60 seconds - verify a pageview event appears for localhost:3000
6. Refresh the page - verify another pageview event appears
7. Check Mixpanel is NOT logging debug messages to console
  </how-to-verify>
  <resume-signal>Type "approved" if events visible in dashboard, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] `npm run build` succeeds
- [ ] `npm run dev` runs without hydration errors
- [ ] Browser console shows no OpenPanel/hydration errors
- [ ] Network tab shows op1.js loaded
- [ ] OpenPanel dashboard shows pageview event within 60s
- [ ] Mixpanel console logs gone
</verification>

<success_criteria>
1. OpenPanel SDK loads in app/root.tsx via script tag
2. Pageviews tracked automatically on route navigation
3. Events visible in OpenPanel dashboard
4. Existing Mixpanel tracking continues (minus auto-pageview)
5. No console errors or hydration issues
</success_criteria>

<output>
After completion, create `.planning/phases/01-sdk-integration/01-01-SUMMARY.md`
</output>
